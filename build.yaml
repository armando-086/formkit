targets:
  $default:
    builders:
      # Lógica de generación: Mapea la clase anotada a un esquema y un acceso.
      formkit|formkit_mapper_builder:
        enabled: true
      # Lógica de consolidación: Escanea todos los .ref generados por el mapper.
      formkit|formkit_auto_register_finalizer:
        enabled: true
        
builders:
  formkit_mapper_builder:
    import: "package:formkit/src/generator/build/formkit_mapper_builder.dart"
    builder_factories: ["formKitMapperBuilder"]
    # ✅ CORRECCIÓN CRÍTICA: Solo se espera una extensión de salida (el archivo .dart generado).
    # El archivo .formkit_access_ref es un archivo intermedio que el CombiningBuilder no debe procesar.
    build_extensions:
      .dart: [".formkit_mapper.dart"] 
    auto_apply: dependents
    build_to: source
    # La aplicación de source_gen es la que se encarga de la salida .dart
    applies_builders: ["source_gen|combining_builder"] 

  formkit_auto_register_finalizer:
    import: "package:formkit/src/generator/build/formkit_auto_register_finalizer_builder.dart"
    builder_factories: ["formKitAutoRegisterFinalizerBuilder"]
    build_extensions:
      r'$lib$': ["lib/formkit_auto_register.dart"]
    auto_apply: dependents
    build_to: source
    required_inputs: [".formkit_access_ref"]

post_process_builders:
  formkit_auto_register_collector:
    import: "package:formkit/src/generator/build/formkit_auto_register_builder.dart"
    builder_factory: "formKitAutoRegisterBuilder"
    input_extensions: [".formkit_access_ref"]